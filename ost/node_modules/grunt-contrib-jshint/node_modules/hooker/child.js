var path = require('path');
var fs = require('fs');
var nodeunit = require('nodeunit');

var filepaths = fs.readdirSync('test').map(function(filename) {
  return path.join('test', filename);
});

var unfinished = {};
var currentModule;
function sendMessage(message) {
  process.stdout.write(JSON.stringify(message) + '\n');
}

// If an exception is thrown, let the parent process know and exit.
process.on('uncaughtException', function (e) {
  sendMessage({error: [e.name, e.message, e.stack]});
  process.exit()